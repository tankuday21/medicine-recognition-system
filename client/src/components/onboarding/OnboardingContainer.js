// Onboarding Container Component\n// Main container that orchestrates the complete onboarding experience\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { onboardingFlowManager, interactiveTutorialSystem } from '../../utils/onboardingSystem';\nimport { OnboardingFlow } from './OnboardingFlow';\nimport { GuidedTour, TutorialLauncher } from './GuidedTour';\nimport { OnboardingProgress } from './OnboardingProgress';\nimport { PersonalizedOnboardingSetup } from './PersonalizedOnboarding';\nimport { Button } from '../ui/Button';\nimport { Card } from '../ui/Card';\nimport { Badge } from '../ui/Badge';\n\n/**\n * Main Onboarding Container\n */\nexport const OnboardingContainer = ({ \n  userId,\n  userRole = 'general',\n  userLevel = 'beginner',\n  onComplete,\n  onDismiss,\n  showProgress = true,\n  autoStart = false\n}) => {\n  const [currentView, setCurrentView] = useState('welcome'); // welcome, setup, flow, tutorial, progress\n  const [userProfile, setUserProfile] = useState(null);\n  const [activeFlow, setActiveFlow] = useState(null);\n  const [activeTutorial, setActiveTutorial] = useState(null);\n  const [onboardingStats, setOnboardingStats] = useState(null);\n  const [showWelcome, setShowWelcome] = useState(true);\n\n  useEffect(() => {\n    initializeOnboarding();\n  }, [userId, userRole, userLevel]);\n\n  const initializeOnboarding = useCallback(() => {\n    // Load onboarding statistics\n    const stats = onboardingFlowManager.getOnboardingStats();\n    setOnboardingStats(stats);\n\n    // Check if user has completed basic onboarding\n    const hasCompletedBasic = onboardingFlowManager.completedFlows.has('basic');\n    \n    if (autoStart && !hasCompletedBasic) {\n      // Check if user has a personalized path\n      const personalizedPath = onboardingFlowManager.personalizedPaths.get(userId);\n      \n      if (personalizedPath) {\n        setCurrentView('flow');\n        startOnboardingFlow();\n      } else {\n        setCurrentView('setup');\n      }\n    } else if (hasCompletedBasic) {\n      setShowWelcome(false);\n      setCurrentView('progress');\n    }\n  }, [userId, userRole, userLevel, autoStart]);\n\n  const handleWelcomeComplete = () => {\n    setShowWelcome(false);\n    setCurrentView('setup');\n  };\n\n  const handleSetupComplete = (profile, personalizedPath) => {\n    setUserProfile(profile);\n    setCurrentView('flow');\n    \n    // Start the first flow in the personalized path\n    if (personalizedPath && personalizedPath.flows.length > 0) {\n      const firstFlowId = personalizedPath.flows[0];\n      startSpecificFlow(firstFlowId);\n    } else {\n      startOnboardingFlow();\n    }\n  };\n\n  const handleSetupSkip = () => {\n    setCurrentView('flow');\n    startOnboardingFlow();\n  };\n\n  const startOnboardingFlow = () => {\n    const flow = onboardingFlowManager.getOnboardingFlow(userRole, userLevel);\n    if (flow) {\n      setActiveFlow(flow.id);\n    } else {\n      setCurrentView('progress');\n    }\n  };\n\n  const startSpecificFlow = (flowId) => {\n    setActiveFlow(flowId);\n    setCurrentView('flow');\n  };\n\n  const handleFlowComplete = (flow) => {\n    setActiveFlow(null);\n    \n    // Check if there are more flows in the personalized path\n    if (userId) {\n      const nextFlow = onboardingFlowManager.getNextRecommendedFlow(userId);\n      if (nextFlow) {\n        // Show option to continue with next flow\n        setCurrentView('continue');\n      } else {\n        setCurrentView('progress');\n      }\n    } else {\n      setCurrentView('progress');\n    }\n    \n    if (onComplete) {\n      onComplete(flow);\n    }\n  };\n\n  const handleFlowSkip = (flow) => {\n    setActiveFlow(null);\n    setCurrentView('progress');\n  };\n\n  const startTutorial = (tutorialId) => {\n    setActiveTutorial(tutorialId);\n    setCurrentView('tutorial');\n  };\n\n  const handleTutorialComplete = (tutorial) => {\n    setActiveTutorial(null);\n    setCurrentView('progress');\n  };\n\n  const handleTutorialExit = () => {\n    setActiveTutorial(null);\n    setCurrentView('progress');\n  };\n\n  const handleViewProgress = () => {\n    setCurrentView('progress');\n  };\n\n  const handleDismiss = () => {\n    if (onDismiss) {\n      onDismiss();\n    }\n  };\n\n  const renderCurrentView = () => {\n    switch (currentView) {\n      case 'welcome':\n        return (\n          <WelcomeScreen\n            onGetStarted={handleWelcomeComplete}\n            onDismiss={handleDismiss}\n            stats={onboardingStats}\n          />\n        );\n        \n      case 'setup':\n        return (\n          <PersonalizedOnboardingSetup\n            userId={userId}\n            onComplete={handleSetupComplete}\n            onSkip={handleSetupSkip}\n            initialProfile={{ role: userRole, experience: userLevel }}\n          />\n        );\n        \n      case 'flow':\n        return (\n          <OnboardingFlow\n            userRole={userRole}\n            userLevel={userLevel}\n            onComplete={handleFlowComplete}\n            onSkip={handleFlowSkip}\n            autoStart={true}\n          />\n        );\n        \n      case 'tutorial':\n        return (\n          <GuidedTour\n            tutorialId={activeTutorial}\n            onComplete={handleTutorialComplete}\n            onExit={handleTutorialExit}\n            autoStart={true}\n          />\n        );\n        \n      case 'continue':\n        return (\n          <ContinueScreen\n            userId={userId}\n            onContinue={() => {\n              const nextFlow = onboardingFlowManager.getNextRecommendedFlow(userId);\n              if (nextFlow) {\n                startSpecificFlow(nextFlow.id);\n              }\n            }}\n            onFinish={() => setCurrentView('progress')}\n          />\n        );\n        \n      case 'progress':\n      default:\n        return (\n          <div className=\"space-y-6\">\n            <OnboardingProgress\n              userId={userId}\n              onFlowStart={startSpecificFlow}\n              onFlowReset={(flowId) => {\n                // Refresh stats after reset\n                const stats = onboardingFlowManager.getOnboardingStats();\n                setOnboardingStats(stats);\n              }}\n            />\n            \n            <TutorialLauncher\n              onTutorialStart={startTutorial}\n            />\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"onboarding-container\">\n      <AnimatePresence mode=\"wait\">\n        <motion.div\n          key={currentView}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: -20 }}\n          transition={{ duration: 0.3 }}\n        >\n          {renderCurrentView()}\n        </motion.div>\n      </AnimatePresence>\n    </div>\n  );\n};\n\n/**\n * Welcome Screen Component\n */\nconst WelcomeScreen = ({ onGetStarted, onDismiss, stats }) => {\n  const hasExistingProgress = stats && stats.completedFlows > 0;\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <Card className=\"p-8 text-center\">\n        <div className=\"mb-6\">\n          <div className=\"w-20 h-20 mx-auto bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mb-4\">\n            <svg className=\"w-10 h-10 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n            </svg>\n          </div>\n          \n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n            Welcome to MedIoT Premium\n          </h1>\n          \n          <p className=\"text-lg text-gray-600 mb-6\">\n            Your intelligent medical interface designed for healthcare professionals\n          </p>\n        </div>\n\n        {hasExistingProgress ? (\n          <div className=\"mb-6\">\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\n              <h3 className=\"font-medium text-blue-900 mb-2\">\n                Welcome Back!\n              </h3>\n              <p className=\"text-sm text-blue-800\">\n                You've completed {stats.completedFlows} onboarding flows and {stats.completedSteps} steps.\n                Continue where you left off or explore new features.\n              </p>\n            </div>\n          </div>\n        ) : (\n          <div className=\"mb-6\">\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n              Let's get you started\n            </h2>\n            \n            <div className=\"grid md:grid-cols-3 gap-4 mb-6\">\n              <div className=\"p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl mb-2\">üéØ</div>\n                <h3 className=\"font-medium text-gray-900 mb-1\">Personalized</h3>\n                <p className=\"text-sm text-gray-600\">Tailored to your role and experience</p>\n              </div>\n              \n              <div className=\"p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl mb-2\">‚ö°</div>\n                <h3 className=\"font-medium text-gray-900 mb-1\">Interactive</h3>\n                <p className=\"text-sm text-gray-600\">Learn by doing with guided tutorials</p>\n              </div>\n              \n              <div className=\"p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl mb-2\">üèÜ</div>\n                <h3 className=\"font-medium text-gray-900 mb-1\">Rewarding</h3>\n                <p className=\"text-sm text-gray-600\">Track progress and earn achievements</p>\n              </div>\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n          <Button\n            size=\"lg\"\n            onClick={onGetStarted}\n            className=\"px-8\"\n          >\n            {hasExistingProgress ? 'Continue Learning' : 'Get Started'}\n          </Button>\n          \n          {onDismiss && (\n            <Button\n              variant=\"ghost\"\n              size=\"lg\"\n              onClick={onDismiss}\n              className=\"px-8\"\n            >\n              Skip for Now\n            </Button>\n          )}\n        </div>\n        \n        <p className=\"text-xs text-gray-500 mt-4\">\n          You can access onboarding anytime from the help menu\n        </p>\n      </Card>\n    </div>\n  );\n};\n\n/**\n * Continue Screen Component\n */\nconst ContinueScreen = ({ userId, onContinue, onFinish }) => {\n  const [nextFlow, setNextFlow] = useState(null);\n\n  useEffect(() => {\n    const flow = onboardingFlowManager.getNextRecommendedFlow(userId);\n    setNextFlow(flow);\n  }, [userId]);\n\n  return (\n    <div className=\"max-w-md mx-auto\">\n      <Card className=\"p-6 text-center\">\n        <div className=\"mb-6\">\n          <div className=\"w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center mb-4\">\n            <svg className=\"w-8 h-8 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          </div>\n          \n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\n            Great Progress!\n          </h2>\n          \n          <p className=\"text-gray-600 mb-4\">\n            You've completed another onboarding flow. Ready to continue?\n          </p>\n        </div>\n\n        {nextFlow && (\n          <div className=\"mb-6\">\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n              <h3 className=\"font-medium text-blue-900 mb-1\">\n                Next: {nextFlow.title}\n              </h3>\n              <p className=\"text-sm text-blue-800 mb-2\">\n                {nextFlow.description}\n              </p>\n              <div className=\"text-xs text-blue-600\">\n                ~{nextFlow.estimatedTime} minutes\n              </div>\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex flex-col gap-3\">\n          {nextFlow && (\n            <Button onClick={onContinue} className=\"w-full\">\n              Continue with {nextFlow.title}\n            </Button>\n          )}\n          \n          <Button\n            variant=\"ghost\"\n            onClick={onFinish}\n            className=\"w-full\"\n          >\n            Finish for Now\n          </Button>\n        </div>\n      </Card>\n    </div>\n  );\n};\n\n/**\n * Onboarding Status Widget (for dashboard)\n */\nexport const OnboardingStatusWidget = ({ \n  userId, \n  onStartOnboarding, \n  onViewProgress,\n  compact = false \n}) => {\n  const [stats, setStats] = useState(null);\n  const [nextRecommendation, setNextRecommendation] = useState(null);\n\n  useEffect(() => {\n    const onboardingStats = onboardingFlowManager.getOnboardingStats();\n    setStats(onboardingStats);\n\n    if (userId) {\n      const next = onboardingFlowManager.getNextRecommendedFlow(userId);\n      setNextRecommendation(next);\n    }\n  }, [userId]);\n\n  if (!stats) {\n    return (\n      <Card className=\"p-4 animate-pulse\">\n        <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n        <div className=\"h-2 bg-gray-200 rounded\"></div>\n      </Card>\n    );\n  }\n\n  const completionPercentage = (stats.completedFlows / stats.totalFlows) * 100;\n  const isComplete = completionPercentage >= 100;\n\n  if (compact) {\n    return (\n      <div className=\"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center justify-between mb-1\">\n            <span className=\"text-sm font-medium text-gray-900\">\n              Onboarding\n            </span>\n            <Badge variant={isComplete ? 'success' : 'primary'} size=\"sm\">\n              {Math.round(completionPercentage)}%\n            </Badge>\n          </div>\n          <div className=\"w-full bg-gray-200 rounded-full h-1.5\">\n            <div \n              className=\"bg-blue-600 h-1.5 rounded-full transition-all duration-300\"\n              style={{ width: `${completionPercentage}%` }}\n            />\n          </div>\n        </div>\n        \n        {!isComplete && onStartOnboarding && (\n          <Button size=\"sm\" onClick={onStartOnboarding}>\n            Continue\n          </Button>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <Card className=\"p-4\">\n      <div className=\"flex items-center justify-between mb-3\">\n        <h3 className=\"font-medium text-gray-900\">\n          Onboarding Progress\n        </h3>\n        <Badge variant={isComplete ? 'success' : 'primary'}>\n          {Math.round(completionPercentage)}%\n        </Badge>\n      </div>\n      \n      <div className=\"w-full bg-gray-200 rounded-full h-2 mb-4\">\n        <motion.div\n          className=\"bg-blue-600 h-2 rounded-full\"\n          initial={{ width: 0 }}\n          animate={{ width: `${completionPercentage}%` }}\n          transition={{ duration: 0.5 }}\n        />\n      </div>\n      \n      <div className=\"text-sm text-gray-600 mb-4\">\n        {isComplete ? (\n          <span className=\"text-green-600 font-medium\">\n            üéâ Onboarding complete! You're all set.\n          </span>\n        ) : (\n          <span>\n            {stats.completedFlows} of {stats.totalFlows} flows completed\n          </span>\n        )}\n      </div>\n      \n      {nextRecommendation && !isComplete && (\n        <div className=\"mb-4\">\n          <p className=\"text-sm text-gray-600 mb-2\">\n            Next: {nextRecommendation.title}\n          </p>\n          {onStartOnboarding && (\n            <Button size=\"sm\" onClick={onStartOnboarding} className=\"w-full\">\n              Continue Learning\n            </Button>\n          )}\n        </div>\n      )}\n      \n      {onViewProgress && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={onViewProgress}\n          className=\"w-full text-gray-600 hover:text-gray-800\"\n        >\n          View Details\n        </Button>\n      )}\n    </Card>\n  );\n};\n\nexport default OnboardingContainer;"